var myApp=angular.module("myApp",["videoServiceProvider","app.routes","mainCtrl","videosCtrl","videoCtrl","playlistsCtrl","playlistCtrl","homeCtrl"]);angular.module("homeCtrl",[]).controller("homeController",function($http,$scope){function getVideos(){$http.get(" https://www.googleapis.com/youtube/v3/playlistItems?part=snippet%2ccontentDetails&playlistId="+$scope.uploadsPlaylistId+"&maxResults=1&key="+$scope.settings.api_key).success(function(res){$scope.mostRecent=res})}$scope.loading=!0,$http.get("https://www.googleapis.com/youtube/v3/channels?part=contentDetails&forUsername="+$scope.settings.channel+"&key="+$scope.settings.api_key).success(function(res){$scope.uploadsPlaylistId=res.items[0].contentDetails.relatedPlaylists.uploads,getVideos(),s(".show-hide").on("click",function(){getMore()})})}),angular.module("mainCtrl",[]).controller("mainController",function($http,$scope,$rootScope,$window,$location){$http.get("app/model/settings.json").success(function(res){$scope.settings=res}),s(".sub-head").on("mouseenter",function(){s(".sub").css("display","block")}).on("mouseleave",function(){s(".sub").css("display","none")}),$rootScope.$on("$locationChangeStart",function(event,next,current){s("header").removeClass()}),$rootScope.$on("$routeChangeSuccess",function(event,next,current){$window.ga("send","pageview",{page:$location.path()})})}),angular.module("playlistCtrl",[]).controller("playlistController",function($http,$scope,$location,$sce){function getVideos(){$http.get(" https://www.googleapis.com/youtube/v3/playlistItems?part=contentDetails%2C+snippet&playlistId="+playlistId+"&maxResults=9&key="+$scope.settings.api_key).success(function(res){$scope.videos=res.items,$scope.nextToken=res.nextPageToken,getPlaylistName(),$scope.loading=!1})}function getPlaylistName(){$http.get("https://www.googleapis.com/youtube/v3/playlists?part=snippet&id="+playlistId+"&key="+$scope.settings.api_key).success(function(res){$scope.playlistTitle=res.items[0].snippet.title})}function getMore(){$scope.loading=!0,$http.get(" https://www.googleapis.com/youtube/v3/playlistItems?part=contentDetails%2C+snippet&playlistId="+playlistId+"&maxResults=9&pageToken="+$scope.nextToken+"&key="+$scope.settings.api_key).success(function(res){for(var i=0;i<res.items.length;i++)$scope.videos.push(res.items[i]);$scope.nextToken=res.nextPageToken,$scope.loading=!1})}var playlistId=$location.path().substr(11,$location.path().length-1);console.log(playlistId),$scope.loading=!0,$scope.finished=!1,getVideos(),s(".show-hide").on("click",function(){getMore()})}),angular.module("playlistsCtrl",[]).controller("playlistsController",function($http,$scope,$location){function getPlaylists(){$http.get("https://www.googleapis.com/youtube/v3/playlists?part=contentDetails%2csnippet&channelId="+$scope.channelId+"&maxResults=9&key="+$scope.settings.api_key).success(function(res){$scope.playlists=res.items,$scope.nextToken=res.nextPageToken}),$scope.loading=!1}function getMore(){$scope.loading=!0,$http.get("https://www.googleapis.com/youtube/v3/playlists?part=contentDetails%2csnippet&channelId="+$scope.channelId+"&maxResults=9&pageToken="+$scope.nextToken+"&key="+$scope.settings.api_key).success(function(res){for(var i=0;i<res.items.length;i++)$scope.playlists.push(res.items[i]);$scope.nextToken=res.nextPageToken,$scope.loading=!1})}$scope.loading=!0,$http.get("https://www.googleapis.com/youtube/v3/channels?part=contentDetails&forUsername="+$scope.settings.channel+"&key="+$scope.settings.api_key).success(function(res){$scope.channelId=res.items[0].id,getPlaylists(),s(".show-hide").on("click",function(){getMore()})})}),angular.module("videoCtrl",[]).controller("videoController",function($http,$scope,$location,$sce){function setPublishAtDate(){var date=new Date($scope.video.snippet.publishedAt),formattedDate="";switch(date.getMonth()){case 0:formattedDate="January";break;case 1:formattedDate="February";break;case 2:formattedDate="March";break;case 3:formattedDate="April";break;case 4:formattedDate="May";break;case 5:formattedDate="June";break;case 6:formattedDate="July";break;case 7:formattedDate="August";break;case 8:formattedDate="September";break;case 9:formattedDate="October";break;case 10:formattedDate="November";break;case 11:formattedDate="December"}formattedDate=formattedDate+" "+date.getDate()+", "+date.getFullYear(),$scope.video.snippet.publishedAt=formattedDate}function preserveDescription(){var description=$scope.video.snippet.description;description=preserveLinks(description),description=description.replace(/\n/g,"<br>"),$scope.video.snippet.description=description}function preserveLinks(d){return d=d.replace(/(http:\/\/[^\s]+)/gi,'<a href="$1">$1</a>'),d=d.replace(/(https:\/\/[^\s]+)/gi,'<a href="$1">$1</a>')}function numberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function sideBar(){$http.get("https://www.googleapis.com/youtube/v3/channels?part=contentDetails&forUsername="+$scope.settings.channel+"&key="+$scope.settings.api_key).success(function(res){$scope.channelId=res.items[0].id,getVideos()})}function getVideos(){$scope.recentLoading=!0,$http.get("https://www.googleapis.com/youtube/v3/activities?part=contentDetails%2Csnippet&channelId="+$scope.channelId+"&maxResults=5&key="+$scope.settings.api_key).success(function(res){$scope.recentVideos=[],$scope.nextToken=res.nextPageToken;for(var i=0;i<res.items.length;i++)"upload"===res.items[i].snippet.type&&$scope.recentVideos.push(res.items[i]);$scope.recentLoading=!1})}function checkShow(){var title=$scope.video.snippet.title;title.indexOf("Grumpcade")>=0?s("header").addClass("grumpcade"):title.indexOf("Steam Train")>=0?s("header").addClass("steam-train"):title.indexOf("Table Flip")>=0?s("header").addClass("table-flip"):s("header").removeClass()}var video_id=$location.path().substr(8,$location.path().length-1);$http.get("https://www.googleapis.com/youtube/v3/videos?part=snippet%2cstatistics&id="+video_id+"&key="+$scope.settings.api_key).success(function(res){$scope.video=res.items[0],setPublishAtDate(),preserveDescription(),$scope.recentLoading=!0,sideBar(),$scope.video.player=$sce.trustAsResourceUrl("https://www.youtube.com/embed/"+video_id+"?autoplay=0&showinfo=0"),s(".show-hide").on("click",function(){s(".description").hasClass("full")[0]?(s(".description").removeClass("full"),s(this).innerHtml("Show More")):(s(".description").addClass("full"),s(this).innerHtml("Hide"))});var likes=Number($scope.video.statistics.likeCount),total=Number($scope.video.statistics.dislikeCount)+likes;likeRatio=likes/total*100,s(".like-bar").css("width",String(likeRatio+"%")),$scope.video.statistics.viewCount=numberWithCommas($scope.video.statistics.viewCount),$scope.video.statistics.likeCount=numberWithCommas($scope.video.statistics.likeCount),$scope.video.statistics.dislikeCount=numberWithCommas($scope.video.statistics.dislikeCount),checkShow()})}).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),angular.module("videosCtrl",[]).controller("videosController",function($http,$scope){function getVideos(){$http.get("https://www.googleapis.com/youtube/v3/activities?part=contentDetails%2Csnippet&channelId="+$scope.channelId+"&maxResults=9&key="+$scope.settings.api_key).success(function(res){$scope.videos=[],$scope.nextToken=res.nextPageToken;for(var i=0;i<res.items.length;i++)"upload"===res.items[i].snippet.type&&$scope.videos.push(res.items[i]);$scope.loading=!1})}function getMore(){$scope.loading=!0,$http.get("https://www.googleapis.com/youtube/v3/activities?part=contentDetails%2Csnippet&channelId="+$scope.channelId+"&maxResults=9&pageToken="+$scope.nextToken+"&key="+$scope.settings.api_key).success(function(res){console.log(res),$scope.nextToken=res.nextPageToken;for(var i=0;i<res.items.length;i++)"upload"===res.items[i].snippet.type&&$scope.videos.push(res.items[i]);$scope.loading=!1})}$scope.loading=!0,$http.get("https://www.googleapis.com/youtube/v3/channels?part=contentDetails&forUsername="+$scope.settings.channel+"&key="+$scope.settings.api_key).success(function(res){$scope.channelId=res.items[0].id,getVideos(),s(".show-hide").on("click",function(){getMore()})})});var route=angular.module("app.routes",["ngRoute"]);route.config(function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"app/views/home.html",controller:"homeController",controllerAs:"home"}).when("/videos/",{templateUrl:"app/views/videos.html",controller:"videosController",controllerAs:"videos"}).when("/videos/:video_id",{templateUrl:"app/views/video.html",controller:"videoController",controllerAs:"video"}).when("/playlists/",{templateUrl:"app/views/playlists.html",controller:"playlistsController",controllerAs:"playlists"}).when("/playlists/:playlist_id",{templateUrl:"app/views/playlist.html",controller:"playlistController",controllerAs:"playlist"}).when("/404",{templateUrl:"app/views/404.html"})}),angular.module("videoServiceProvider",[]).service("videoService",function($http){});